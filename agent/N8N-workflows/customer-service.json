{
  "name": "Instagram Customer Service Router",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "instagram-dm-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-dm",
      "name": "DM Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "instagram-comment-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-comment",
      "name": "Comment Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 450]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "schedule-1",
      "name": "Check Messages",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 600]
    },
    {
      "parameters": {
        "content": "## Customer Service Automation\n\nThis workflow provides 24/7 customer service by:\n1. Monitoring DMs and comments\n2. Classifying inquiries by type and urgency\n3. Auto-responding to common questions\n4. Escalating complex/negative issues\n5. Tracking response times and satisfaction\n\nQuery Categories:\n- Sizing & Fit\n- Shipping & Delivery\n- Returns & Exchanges\n- Product Availability\n- Order Status\n- Complaints\n- General Inquiries",
        "height": 250,
        "width": 350
      },
      "id": "sticky-1",
      "name": "Workflow Overview",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [100, 50]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "multiplex",
        "options": {}
      },
      "id": "merge-sources",
      "name": "Merge Message Sources",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [450, 450]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://graph.facebook.com/v18.0/{{ $credentials.instagram_business_account_id }}/conversations",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "platform",
              "value": "instagram"
            },
            {
              "name": "fields",
              "value": "participants,messages{id,message,from,created_time,attachments}"
            },
            {
              "name": "limit",
              "value": "20"
            },
            {
              "name": "access_token",
              "value": "={{ $credentials.accessToken }}"
            }
          ]
        },
        "options": {}
      },
      "id": "http-conversations",
      "name": "Get Recent Conversations",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [650, 600],
      "credentials": {
        "facebookGraphApi": {
          "id": "5",
          "name": "Facebook Graph API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Process and classify customer messages\nconst messages = $input.all();\nconst processedMessages = [];\n\n// Response templates by category\nconst templates = {\n  sizing: {\n    keywords: ['size', 'fit', 'measurement', 'small', 'medium', 'large', 'xl', 'xxl', 'chart'],\n    response: \"Hi! ðŸ“ Our size guide is available at [yourstore.com/size-guide]. Generally, our items run true to size. For specific measurements, please let me know which item you're interested in!\",\n    priority: 'medium'\n  },\n  shipping: {\n    keywords: ['ship', 'delivery', 'arrive', 'send', 'track', 'shipping', 'express'],\n    response: \"ðŸ“¦ We offer worldwide shipping! Standard delivery takes 5-7 business days, Express 2-3 days. You'll receive tracking info once your order ships. Which shipping option works best for you?\",\n    priority: 'medium'\n  },\n  returns: {\n    keywords: ['return', 'exchange', 'refund', 'change', 'wrong', 'defect'],\n    response: \"We're happy to help with returns! ðŸ”„ You have 30 days to return unworn items with tags. Visit [yourstore.com/returns] for our easy return process. What would you like to return/exchange?\",\n    priority: 'high'\n  },\n  availability: {\n    keywords: ['stock', 'available', 'sold out', 'when', 'restock', 'back in stock'],\n    response: \"Let me check availability for you! ðŸ” Which item and size are you looking for? I'll confirm stock status right away.\",\n    priority: 'medium'\n  },\n  order_status: {\n    keywords: ['order', 'status', 'where', 'tracking', 'number', 'confirmation'],\n    response: \"I'd be happy to check your order status! ðŸ“‹ Please share your order number or email address, and I'll look that up for you immediately.\",\n    priority: 'high'\n  },\n  complaint: {\n    keywords: ['bad', 'terrible', 'worst', 'hate', 'problem', 'issue', 'broken', 'damaged', 'unhappy', 'disappointed'],\n    response: \"I'm really sorry to hear about this issue. ðŸ˜” Your experience is important to us. I'm escalating this to our team lead who will personally assist you within the hour. Can you share more details about what happened?\",\n    priority: 'urgent'\n  },\n  price: {\n    keywords: ['price', 'cost', 'expensive', 'cheap', 'discount', 'sale', 'coupon', 'promo'],\n    response: \"ðŸ’° Our current prices are listed on the website! We often have special promotions - follow us to stay updated. Would you like me to check if there are any active discounts for the item you're interested in?\",\n    priority: 'low'\n  },\n  praise: {\n    keywords: ['love', 'amazing', 'great', 'beautiful', 'perfect', 'awesome', 'thank', 'best'],\n    response: \"Thank you so much for the kind words! ðŸ˜ We're thrilled you love your purchase. We'd love to see how you style it - tag us in your photos! Is there anything else we can help you with?\",\n    priority: 'low'\n  }\n};\n\n// Process each message\nmessages.forEach(item => {\n  let messageData;\n  \n  // Handle different message formats\n  if (item.json.message) {\n    messageData = {\n      text: item.json.message,\n      from: item.json.from,\n      id: item.json.id,\n      timestamp: item.json.created_time || new Date().toISOString(),\n      type: 'dm'\n    };\n  } else if (item.json.messages && item.json.messages.data) {\n    // Process conversation messages\n    item.json.messages.data.forEach(msg => {\n      if (msg.from.id !== $credentials.instagram_business_account_id) {\n        messageData = {\n          text: msg.message,\n          from: msg.from,\n          id: msg.id,\n          timestamp: msg.created_time,\n          type: 'dm',\n          conversation_id: item.json.id\n        };\n      }\n    });\n  } else if (item.json.text) {\n    messageData = {\n      text: item.json.text,\n      from: item.json.from || { username: 'unknown' },\n      id: item.json.id,\n      timestamp: item.json.timestamp || new Date().toISOString(),\n      type: 'comment'\n    };\n  }\n  \n  if (messageData && messageData.text) {\n    // Classify message\n    const lowerText = messageData.text.toLowerCase();\n    let category = 'general';\n    let matchedTemplate = null;\n    let confidence = 0;\n    \n    // Check each category\n    for (const [cat, template] of Object.entries(templates)) {\n      const matches = template.keywords.filter(keyword => \n        lowerText.includes(keyword)\n      ).length;\n      \n      if (matches > confidence) {\n        confidence = matches;\n        category = cat;\n        matchedTemplate = template;\n      }\n    }\n    \n    // Check if message is a question\n    const isQuestion = lowerText.includes('?') || \n      lowerText.includes('how') || \n      lowerText.includes('what') || \n      lowerText.includes('when') || \n      lowerText.includes('where');\n    \n    // Determine if human intervention needed\n    const needsHuman = \n      category === 'complaint' ||\n      confidence === 0 ||\n      messageData.text.length > 200 ||\n      lowerText.includes('urgent') ||\n      lowerText.includes('asap');\n    \n    processedMessages.push({\n      json: {\n        ...messageData,\n        category: category,\n        confidence: confidence,\n        priority: matchedTemplate?.priority || 'medium',\n        suggested_response: matchedTemplate?.response || null,\n        needs_human: needsHuman,\n        is_question: isQuestion\n      }\n    });\n  }\n});\n\n// Filter out already processed messages\nconst processedIds = $getWorkflowStaticData('processed_messages') || [];\nconst newMessages = processedMessages.filter(msg => \n  !processedIds.includes(msg.json.id)\n);\n\n// Update processed IDs\nif (newMessages.length > 0) {\n  const updatedIds = [...processedIds, ...newMessages.map(m => m.json.id)];\n  // Keep only last 500 IDs\n  if (updatedIds.length > 500) {\n    updatedIds.splice(0, updatedIds.length - 500);\n  }\n  $setWorkflowStaticData('processed_messages', updatedIds);\n}\n\nreturn newMessages;"
      },
      "id": "code-classify",
      "name": "Classify Messages",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 450]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "condition-1",
                    "leftValue": "={{ $json.priority }}",
                    "rightValue": "urgent",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Urgent"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "condition-2",
                    "leftValue": "={{ $json.needs_human }}",
                    "rightValue": "={{ true }}",
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Human Required"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "condition-3",
                    "leftValue": "={{ $json.suggested_response }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Auto Response"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "switch-priority",
      "name": "Route by Priority",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1050, 450]
    },
    {
      "parameters": {
        "channel": "#urgent-support",
        "text": "ðŸš¨ URGENT: Customer Service Issue",
        "attachments": [
          {
            "color": "#FF0000",
            "fields": {
              "values": [
                {
                  "title": "From",
                  "value": "@{{ $json.from.username || $json.from.name }}",
                  "short": true
                },
                {
                  "title": "Category",
                  "value": "{{ $json.category }}",
                  "short": true
                },
                {
                  "title": "Message",
                  "value": "{{ $json.text }}",
                  "short": false
                },
                {
                  "title": "Type",
                  "value": "{{ $json.type === 'dm' ? 'Direct Message' : 'Comment' }}",
                  "short": true
                },
                {
                  "title": "Time",
                  "value": "{{ DateTime.fromISO($json.timestamp).toRelative() }}",
                  "short": true
                }
              ]
            },
            "actions": [
              {
                "type": "button",
                "text": "Open Instagram",
                "url": "https://www.instagram.com/direct/inbox/"
              }
            ]
          }
        ],
        "otherOptions": {
          "username": "CS Bot",
          "icon_emoji": ":rotating_light:"
        }
      },
      "id": "slack-urgent",
      "name": "Alert Urgent",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1300, 250],
      "credentials": {
        "slackApi": {
          "id": "2",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "assignmentMode": "rules",
        "rules": {
          "values": [
            {
              "field": "category",
              "operation": "equal",
              "value": "order_status",
              "assignee": "order_support_team"
            },
            {
              "field": "category", 
              "operation": "equal",
              "value": "returns",
              "assignee": "returns_team"
            },
            {
              "field": "category",
              "operation": "equal",
              "value": "complaint",
              "assignee": "senior_support"
            }
          ]
        },
        "fallbackAssignee": "general_support"
      },
      "id": "assign-human",
      "name": "Assign to Human",
      "type": "n8n-nodes-base.customerIo",
      "typeVersion": 1,
      "position": [1300, 400]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are a friendly customer service representative for a niche clothing brand. Use the suggested response as a base but personalize it based on the customer's specific question. Keep responses under 200 characters for Instagram. Use appropriate emojis. Be helpful, warm, and professional."
            },
            {
              "role": "user",
              "content": "Customer message: {{ $json.text }}\n\nCategory: {{ $json.category }}\nSuggested template: {{ $json.suggested_response }}\n\nGenerate a personalized response."
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 150
        }
      },
      "id": "openai-response",
      "name": "Personalize Response",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.2,
      "position": [1300, 550],
      "credentials": {
        "openAiApi": {
          "id": "4",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://langchain-agent:3002/approve/dm-reply",
        "authentication": "none",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-API-Key",
              "value": "={{ $env.AGENT_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": []
        },
        "jsonBody": "={{ JSON.stringify({\n  \"message_id\": $('Merge Message Sources').item.json.id,\n  \"dm_text\": $('Merge Message Sources').item.json.text || $('Merge Message Sources').item.json.message,\n  \"sender_username\": $('Merge Message Sources').item.json.from?.username || \"unknown\",\n  \"sender_id\": $('Merge Message Sources').item.json.from?.id || \"unknown\",\n  \"business_account_id\": $credentials.instagram_business_account_id,\n  \"proposed_reply\": $('Personalize Response').item.json.message.content,\n  \"detected_intent\": $('Classify Messages').item.json.category,\n  \"sentiment\": $('Classify Messages').item.json.sentiment || \"neutral\",\n  \"within_24h_window\": true,\n  \"priority\": $('Route by Priority').item.json.priority || \"medium\",\n  \"customer_history\": {\n    \"previous_interactions\": 0,\n    \"sentiment_history\": \"neutral\",\n    \"lifetime_value\": 0\n  }\n}) }}",
        "options": {
          "timeout": 15000,
          "retry": {
            "enabled": true,
            "maxAttempts": 2,
            "waitBetweenAttempts": 1000
          }
        }
      },
      "id": "agent-approval-dm",
      "name": "Agent Approval - Customer Service",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1500, 550]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $('Agent Approval - Customer Service').item.json.approved }}",
              "operation": "equal",
              "value2": true
            }
          ]
        }
      },
      "id": "check-agent-decision",
      "name": "Check Agent Decision",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1700, 550]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-1",
              "leftValue": "={{ $json.type }}",
              "rightValue": "dm",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-dm",
      "name": "Is DM?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1900, 450]
    },
    {
      "parameters": {
        "operation": "log",
        "message": "Agent rejected: {{ $('Agent Approval - Customer Service').item.json.decision_reasoning }}"
      },
      "id": "log-rejection",
      "name": "Log Agent Rejection",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1900, 650]
    },
    {
      "parameters": {
        "channel": "#instagram-automation",
        "text": "ðŸš« Agent rejected customer service response\nReason: {{ $('Agent Approval - Customer Service').item.json.decision_reasoning }}\nOriginal: {{ $('Personalize Response').item.json.message.content }}",
        "otherOptions": {}
      },
      "id": "slack-rejection",
      "name": "Notify Slack - Rejection",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [2100, 650],
      "credentials": {
        "slackApi": {
          "id": "2",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v18.0/{{ $json.conversation_id }}/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "recipient",
              "value": "={{ JSON.stringify({ id: $json.from.id }) }}"
            },
            {
              "name": "message",
              "value": "={{ JSON.stringify({ text: $('Personalize Response').item.json.message.content }) }}"
            },
            {
              "name": "messaging_type",
              "value": "RESPONSE"
            },
            {
              "name": "access_token",
              "value": "={{ $credentials.accessToken }}"
            }
          ]
        },
        "options": {}
      },
      "id": "http-send-dm",
      "name": "Send DM Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1700, 450],
      "credentials": {
        "facebookGraphApi": {
          "id": "5",
          "name": "Facebook Graph API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v18.0/{{ $json.id }}/replies",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "{{ $('Personalize Response').item.json.message.content }}"
            },
            {
              "name": "access_token",
              "value": "={{ $credentials.accessToken }}"
            }
          ]
        },
        "options": {}
      },
      "id": "http-comment-reply",
      "name": "Reply to Comment",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1700, 650],
      "credentials": {
        "facebookGraphApi": {
          "id": "5",
          "name": "Facebook Graph API"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "sheet",
        "operation": "append",
        "sheetId": "YOUR_CS_LOG_SHEET",
        "range": "Customer_Service_Log!A:K",
        "options": {
          "valueInputOption": "USER_ENTERED"
        },
        "values": [
          [
            "={{ $now.toISO() }}",
            "={{ $json.from.username || $json.from.name }}",
            "={{ $json.type }}",
            "={{ $json.category }}",
            "={{ $json.priority }}",
            "={{ $json.text }}",
            "={{ $('Personalize Response').item.json.message.content }}",
            "={{ $json.needs_human ? 'Human + Auto' : 'Automated' }}",
            "={{ $json.confidence }}",
            "={{ DateTime.fromISO($json.timestamp).toISO() }}",
            "={{ $now.diff(DateTime.fromISO($json.timestamp), 'minutes').minutes.toFixed(0) }} min"
          ]
        ]
      },
      "id": "sheets-log",
      "name": "Log Interaction",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1900, 550],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets OAuth2"
        }
      }
    },
    {
      "parameters": {
        "content": "## Response Time Goals\n\n**Target Response Times:**\n- Urgent: < 15 minutes\n- High Priority: < 1 hour\n- Medium: < 2 hours\n- Low: < 4 hours\n\n**Automation Coverage:**\n- 80%+ queries answered automatically\n- 95%+ response rate within targets\n- Human escalation for sensitive issues",
        "height": 180,
        "width": 300
      },
      "id": "sticky-2",
      "name": "SLA Targets",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1300, 50]
    },
    {
      "parameters": {
        "content": "## Quality Assurance\n\nAll automated responses are:\n1. Reviewed weekly for accuracy\n2. Updated based on common questions\n3. Personalized with customer name\n4. Limited to non-committal info\n5. Escalated if sentiment is negative\n\nHuman takeover triggers:\n- Complaints or negative sentiment\n- Complex/multi-part questions\n- Order-specific issues\n- Requests for exceptions\n- VIP customers",
        "height": 220,
        "width": 300
      },
      "id": "sticky-3",
      "name": "QA Guidelines",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1650, 50]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "auto_response_sent",
              "value": "true"
            },
            {
              "name": "response_time_minutes",
              "value": "={{ $now.diff(DateTime.fromISO($json.timestamp), 'minutes').minutes.toFixed(0) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "set-metrics",
      "name": "Set Response Metrics",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [2100, 550]
    },
    {
      "parameters": {
        "channel": "#cs-metrics",
        "text": "âœ… Auto-Response Sent",
        "attachments": [
          {
            "color": "#00FF00",
            "fields": {
              "values": [
                {
                  "title": "Response Time",
                  "value": "{{ $json.response_time_minutes }} minutes",
                  "short": true
                },
                {
                  "title": "Category",
                  "value": "{{ $('Classify Messages').item.json.category }}",
                  "short": true
                },
                {
                  "title": "Confidence",
                  "value": "{{ $('Classify Messages').item.json.confidence }}/5",
                  "short": true
                },
                {
                  "title": "Customer",
                  "value": "@{{ $('Classify Messages').item.json.from.username }}",
                  "short": true
                }
              ]
            }
          }
        ],
        "otherOptions": {}
      },
      "id": "slack-metrics",
      "name": "Track Metrics",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [2300, 550],
      "credentials": {
        "slackApi": {
          "id": "2",
          "name": "Slack API"
        }
      }
    }
  ],
  "connections": {
    "DM Webhook": {
      "main": [
        [
          {
            "node": "Merge Message Sources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Comment Webhook": {
      "main": [
        [
          {
            "node": "Merge Message Sources",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Check Messages": {
      "main": [
        [
          {
            "node": "Get Recent Conversations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Message Sources": {
      "main": [
        [
          {
            "node": "Classify Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Recent Conversations": {
      "main": [
        [
          {
            "node": "Classify Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify Messages": {
      "main": [
        [
          {
            "node": "Route by Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Priority": {
      "main": [
        [
          {
            "node": "Alert Urgent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Assign to Human",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Personalize Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Personalize Response": {
      "main": [
        [
          {
            "node": "Agent Approval - Customer Service",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent Approval - Customer Service": {
      "main": [
        [
          {
            "node": "Check Agent Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Agent Decision": {
      "main": [
        [
          {
            "node": "Is DM?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Agent Rejection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Agent Rejection": {
      "main": [
        [
          {
            "node": "Notify Slack - Rejection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is DM?": {
      "main": [
        [
          {
            "node": "Send DM Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reply to Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send DM Response": {
      "main": [
        [
          {
            "node": "Log Interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reply to Comment": {
      "main": [
        [
          {
            "node": "Log Interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Interaction": {
      "main": [
        [
          {
            "node": "Set Response Metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Response Metrics": {
      "main": [
        [
          {
            "node": "Track Metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ef012345-6789-abcd-ef01-23456789abcd",
  "meta": {
    "templateId": "instagram-customer-service"
  },
  "id": "workflow-cs-001",
  "tags": []
}